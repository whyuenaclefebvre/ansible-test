---
- name: Ajout de dotDeb aux depots
  apt_repository: repo='{{ item }}'
  with_items:
  - deb http://packages.dotdeb.org jessie all
  - deb-src http://packages.dotdeb.org jessie all

- name: Ajout clef dotdeb
  apt_key: url=https://www.dotdeb.orh/dotdeb.gpg

- name: APT update
  apt: update_cache=yes

- name: Installation de PHP
  apt: name={{ item }} state=latest
  with_items: php_packages

# name: Retrait des fonctions dangereuse
  
- lineinfile: dest=/etc/php/7.0/fpm/php.ini regexp= 'disable_functions[\s]?=' line='disable_functions = exec,passthru,shell_exec,proc_open,popen'
- lineinfile: dest=/etc/php/7.0/fpm/php.ini regexp= 'post_max_size[\s]?=' line='post_max_size = {{ php_post_max_size }}'
- lineinfile: dest=/etc/php/7.0/fpm/php.ini regexp= 'upload_max_filesize[\s]?=' line='upload_max_filesize = {{ php_upload_max_filesize }}'
- lineinfile: dest=/etc/php/7.0/fpm/php.ini regexp= 'memory_limit[\s]?=' line='memory_limit = {{ php_memory_limit }}'
- lineinfile: dest=/etc/php/7.0/fpm/php.ini regexp= 'date.timezone[\s]?=' line='date.timezone = {{ php_php_date.timezone }}'
  notify: php restart
